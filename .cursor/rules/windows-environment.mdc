---
globs: "*.bat,*.ps1,*.cmd"
description: "Windows environment specific practices and batch scripting"
---

# Windows 环境开发规范 🪟

## 批处理文件 (.bat)
- 使用 ASCII 字符编码，避免中文字符导致乱码
- 每个批处理文件开头添加 `@echo off` 减少输出干扰
- 使用 `chcp 65001` 设置 UTF-8 编码页（如需要）
- 错误处理使用 `if errorlevel` 或 `if %errorlevel%`

## PowerShell 脚本 (.ps1)
- 使用 UTF-8 编码保存脚本文件
- 脚本开头设置执行策略提醒
- 使用 `try-catch` 块处理异常
- 优先使用 PowerShell cmdlets 而非传统命令

## 路径处理
- 使用反斜杠 `\` 作为路径分隔符
- 处理包含空格的路径时使用双引号
- 避免硬编码绝对路径，使用相对路径或环境变量
- 使用 `%~dp0` 获取批处理文件所在目录

## 环境变量
- 使用 `%USERPROFILE%` 代替 `~`
- 使用 `%APPDATA%` 存储应用数据
- 检查必要的环境变量是否存在

## 权限管理
- 检查管理员权限，避免权限不足错误
- 使用 `powershell -Command` 执行需要提升权限的命令
- 提供非管理员模式的替代方案

## 常用命令映射
- 使用 `dir` 代替 `ls`
- 使用 `type` 代替 `cat`
- 使用 `del` 代替 `rm`
- 使用 `copy` 代替 `cp`

## 编码兼容性
- 处理 GBK 编码的文件时需要特别注意
- 文件读写统一使用 UTF-8 编码
- 命令行输出可能需要编码转换

## 虚拟环境
- 使用 `venv` 或 `conda` 管理Python环境
- 激活脚本路径：`venv\Scripts\activate.bat`
- 在批处理中自动激活虚拟环境

## 示例模板
```batch
@echo off
setlocal enabledelayedexpansion
cd /d "%~dp0"

:: 检查Python环境
python --version >nul 2>&1
if errorlevel 1 (
    echo Python not found!
    pause
    exit /b 1
)

:: 激活虚拟环境
if exist venv\Scripts\activate.bat (
    call venv\Scripts\activate.bat
)

:: 运行主程序
python launcher.py
if errorlevel 1 (
    echo Error occurred!
    pause
    exit /b 1
)
```
